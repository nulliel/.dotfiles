#!/usr/bin/env bash

subheader "emacs"

#-- Config -----------------------------------------------------------------------------------------
local source_path="https://github.com/emacs-mirror/emacs/archive/emacs-25.1.tar.gz"

local source_version="25.1.1"
local emacs_version="0.0.0"

#-- Utilities --------------------------------------------------------------------------------------
get_emacs_version () {
  emacs_version="$(emacs --version | sed -n -e 's/^.*GNU Emacs //p;1q')"
}

#-- Check for existing installation ----------------------------------------------------------------
if command_exists "emacs"; then
  get_emacs_version

  if ! can_update "$emacs_version" "$source_version"; then
    skip "Installing emacs..."
    exit_subheader && return
  fi
fi

#-- Confirm installation ---------------------------------------------------------------------------
local update_string="Install emacs?"

if [[ "$emacs_version" != "0.0.0" ]]; then
  update_string="Update emacs? ($emacs_version -> $source_version)"
fi

if ! confirm_default "$update_string"; then
  skip "Installing emacs..."
  exit_subheader && return
fi

#-- Dependencies -----------------------------------------------------------------------------------
install_build_tools

package_install "texinfo"
package_install "libXpm-devel"
package_install "libjpeg-turbo-devel"
package_install "libtiff-devel"
package_install "giflib-devel"
package_install "ncurses-devel"

package_install "gtk3-devel"
package_install "webkitgtk3-devel"

#-- Installation -----------------------------------------------------------------------------------
do_make_install "$source_path" "--with-x-widgets"

exit_subheader
