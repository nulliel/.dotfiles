#!/usr/bin/env bash

#-- Config -----------------------------------------------------------------------------------------
DOTFILES_DIRECTORY="${HOME}/.dotfiles"
DOTFILES_LOG_FILE="/tmp/dotfiles.log"
DOTFILES_GIT_PATH="git@github.com:nulliel/dotfiles.git"

#-- Banner -----------------------------------------------------------------------------------------
clear
printf '\e[1m'
printf '          888          888     .d888 d8b 888                  \n'
printf '          888          888    d88P"  Y8P 888                  \n'
printf '          888          888    888        888                  \n'
printf '      .d88888  .d88b.  888888 888888 888 888  .d88b.  .d8888b \n'
printf '     d88" 888 d88""88b 888    888    888 888 d8P  Y8b 88K     \n'
printf '     888  888 888  888 888    888    888 888 88888888 "Y8888b.\n'
printf '     Y88b 888 Y88..88P Y88b.  888    888 888 Y8b.          X88\n'
printf '      "Y88888  "Y88P"   "Y888 888    888 888  "Y8888   88888P" \e[0m\n\n'

#-- Sourcing helpers -------------------------------------------------------------------------------
source $DOTFILES_DIRECTORY/lib/help
source $DOTFILES_DIRECTORY/lib/utils

#-- Check for root ---------------------------------------------------------------------------------
if [[ "$EUID" -eq 0 ]]; then
    u_error "This script should not be run using sudo or as the root user" >&2
    exit 1
fi

#-- Ensure sudo access -----------------------------------------------------------------------------
silent_output sudo -n true || {
    u_error "This script requires the use of sudo" >&2
    exit 1
}

#-- Command parsing --------------------------------------------------------------------------------
for opt in $@
do
    case $opt in
        -h|--help)
            run_help && exit
            ;;
        --defaults)
            INSTALL_DEFAULTS=true
            ;;
        --no-packages)
            NO_PACKAGES=true
            ;;
        --no-sync)
            NO_SYNC=true
            ;;
        -*|--*)
            u_error "Invalid option $opt" && exit 1
            ;;
    esac
done

#-- Ensure git is installed ------------------------------------------------------------------------
source $DOTFILES_DIRECTORY/package/git

#-- Sync repository --------------------------------------------------------------------------------
source $DOTFILES_DIRECTORY/lib/sync

#-- Install packages -------------------------------------------------------------------------------
source $DOTFILES_DIRECTORY/lib/packages
