#!/usr/bin/env bash

#-- Config -----------------------------------------------------------------------------------------
DOTFILES_DIRECTORY="${HOME}/.dotfiles"
DOTFILES_TAR_PATH="https://github.com/nulliel/dotfiles/tarball/master"

#-- Check for preexisting configuration ------------------------------------------------------------
if [[ -d "${DOTFILES_DIRECTORY}" || -f "${DOTFILES_DIRECTORY}" ]]; then
  printf "[\033[1;91mError\033[0m] An existing dotfiles configuration has been found\n";
  exit 1
fi

mkdir "${DOTFILES_DIRECTORY}" || {
  printf "[\033[1;91mError\033[0m] Failed to create dotfiles directory\n";
  exit 1
}

#-- Download dotfiles ------------------------------------------------------------------------------
printf "Downloading dotfiles...\n"

readonly dotfiles_tar_file=$(mktemp)

curl -fsSLo "${dotfiles_tar_file}" "${DOTFILES_TAR_PATH}" || {
  printf "[\033[1;91mError\033[0m]] Failed to download dotfiles tarball\n";
  exit 1
}

tar -zxf "${dotfiles_tar_file}" --strip-components 1 -C "${DOTFILES_DIRECTORY}"

#-- Run dotfiles -----------------------------------------------------------------------------------
source "${DOTFILES_DIRECTORY}/bin/dotfiles"
