#!/usr/bin/env bash

#-- Config -----------------------------------------------------------------------------------------
DOTFILES_DIR="${HOME}/.dotfiles"
DOTFILES_TAR="https://github.com/nulliel/dotfiles/tarball/master"

dotfiles_tar=$(mktemp)

#-- Create dotfiles directory ----------------------------------------------------------------------
if [[ -d "${DOTFILES_DIR}" || -f "${DOTFILES_DIR}" ]]; then
  printf "[\033[1;91mError\033[0m] An existing dotfiles configuration has been found.\n";
  exit 1
fi

mkdir "${DOTFILES_DIR}" || {
  printf "[\033[1;91mError\033[0m] Failed to create dotfiles directory.\n";
  exit 1
}

#-- Download dotfiles ------------------------------------------------------------------------------
printf "Downloading dotfiles...\n"

curl -fsLo "$dotfiles_tar" "$DOTFILES_TAR" || {
  printf "[\033[1;91mError\033[0m]] Failed to download dotfiles.\n";
  exit 1
}

#-- Extract dotfiles -------------------------------------------------------------------------------
printf "Extracting dotfiles...\n"

tar -zxf "$dotfiles_tar" --strip-components 1 -C "$DOTFILES_DIR"

#-- Run dotfiles -----------------------------------------------------------------------------------
source "${DOTFILES_DIR}/bin/dotfiles"
