#!/usr/bin/env bash

#-- Public Config ----------------------------------------------------------------------------------
DOTFILES_DIRECTORY="${HOME}/.dotfiles"
DOTFILES_TAR_PATH="https://github.com/nulliel/dotfiles/tarball/master"

#-- Check for preexisting configuration ------------------------------------------------------------
if [[ -d ${DOTFILES_DIRECTORY} || -f ${DOTFILES_DIRECTORY} ]]; then
    printf "[\033[1;91mError\033[0m] An existing dotfiles configuration has been found.\n"
    exit 1
fi

#-- Download Dotfiles ------------------------------------------------------------------------------
printf "Downloading dotfiles..."
mkdir ${DOTFILES_DIRECTORY}

# Remove existing download
if [[ -f /tmp/dotfiles.tar.gz ]]; then
    rm /tmp/dotfiles.tar.gz
fi

# Download dotfiles tarball
curl -fsSLo /tmp/dotfiles.tar.gz ${DOTFILES_TAR_PATH} || {
    printf "\033[91mERROR\033[0m\n"
    exit 1
}

# Extract the tarball
tar -zxf /tmp/dotfiles.tar.gz --strip-components 1 -C ${DOTFILES_DIRECTORY}

# Remove the tarball
rm /tmp/dotfiles.tar.gz

printf "\033[92mOK\033[0m\n"

#-- Install Dotfiles -------------------------------------------------------------------------------
source $DOTFILES_DIRECTORY/bin/dotfiles
